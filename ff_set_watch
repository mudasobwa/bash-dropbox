#!/bin/bash

# shell script to set watches on directory
# @param $1 — the directory to set watch on

# load default configuration
source /etc/forkforge.conf

ICFILE=$INCRON_DIR/$FF_NAME⇑

if [ -n $1 ]; then
  FULLPATH=`readlink -f $1`
  CURR=$FULLPATH
  if [ -f $CURR ] ; then
    grep -e "^$CURR " $ICFILE 2>&1 > /dev/null && exit 111
    CURR=`dirname $CURR`
  fi
  if [ -d $CURR ] ; then
    while [ $CURR != $ROOT_DIR ] ; do
      grep -e "^$CURR " $ICFILE 2>&1 > /dev/null && exit 112
      CURR=`readlink -f $CURR/..`
    done
    echo \
$FULLPATH IN_NO_LOOP,IN_CREATE,IN_MODIFY,IN_MOVED_TO \
          IN_DELETE,IN_MOVED_FROM \
          IN_DELETE_SELF,IN_MOVE_SELF \
  ff_upload \$@ \$# \$% \
  >> $ICFILE
  else
    exit 110
  fi
else
  exit 103
fi
